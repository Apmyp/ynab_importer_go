---
id: "003"
title: "Add support of bagoup"
branch: "feature/003-bagoup"
---

# Add support of bagoup

## Description

Bagoup это команда которая конвертирует iMessage сообщения из файла chat.db в понятный читаемый набор txt файлов.

Тестовая команда:
```cli
bagoup --separate-chats -e EXIMBANK -e 102 -i ~/Library/Messages/chat.db -o ./messages
```

```
```
Тестовая команда фильтрует по двум отправителям: 102 и EXIMBANK. Команда выгрузит все сообщение в поддиректории. Ты можешь выполнить эту команду чтобы посмотреть как она работает, что отвечает и какие файлы создает, а так же сможешь проверить формат текста внутри текстовых файлов.

Примерно такой алгоритм при запуске:
- Проверить что все зависимости доступны
- Загрузить все сообщения используя конфиг
- Распарсить все сообщения по пред заданным шаблонами
- Быть готовым выполнить одну из двух команд ( в будущем больше команд )
  - по-умолчанию выводим сообщения
  - `missing_templates` выводит все сообщения без темплейта


## Acceptance Criteria

- [ ] `bagoup` команда доступна для выполнения
- [ ] `config.yaml` присутствует и содержит список отправителей которые нужно фильтровать. Сейчас это 102 и EXIMBANK
- [ ] При выполнении команды bagoup должна создаваться папка messages с уникальным постфиксом. Эта папка должна быть удалена перед окончанием работы всей программы
- [ ] Сообщения от отправителей это информация о транзакции с банковским аккаунтом. Система должна иметь шаблоны для парсинга каждого сообщения. Программа (например `ynab_importer_go missing_templates`) должна выводить все сообщения для которых не найден шаблон, чтобы отдельной user story мы добавили такие шаблоны. Не все сообщения будут иметь шаблон. Шаблон о транзакции: от кого, куда, сумма, валюта, дата, комментарий. Шаблоны возможно будут меняться в зависимости от отправителя.
- [ ] Список шаблонов для сообщения хардкодом задан в коде программы. Динамически шаблоны не добавляются.
- [ ] Программа пытается определить шаблон для каждого сообщения
- [ ] Программа по умолчанию должна забрать все сообщения из bagoup, спарсить их и вывести на экран последние 2 сообщения от каждого отправителя

## Definition of Done

- [ ] All tests pass
- [ ] Test coverage > 90%
- [ ] Code compiles without errors
- [ ] Code is formatted with gofmt
- [ ] Программа использует goroutine, semaphore и пул горутин для оптимальной работы
- [ ] Following go best practices 
