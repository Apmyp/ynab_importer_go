---
id: "006"
title: "Support foreign exchange rate"
branch: "feature/006-rate"
---

# Support Foreign Exchange Rate

## Description

Все мои транзакции должны считаться относительно MDL - молдавского лея. Если транзакция была сделана в другой валюте, то нужно перевести ее в MDL. Курс обмена надо брать с сайта bnm.md на дату совершения транзакции

https://www.bnm.md/en/official_exchange_rates?get_xml=1&date=10.01.2026

https://www.bnm.md/en/official_exchange_rates?get_xml=1&date={DATE}

Алгоритм такой:
- Взять из конфиг файла валюту по-умолчанию. В нашем случае MDL
- Взять из конфига путь к sqlite базе. По-умолчанию рядом с исполняемым файлом - ynab_importer_go_database.sqlite
- Собрать все транзакции с валютой отличной от валюты по-умолчанию из конфига
- Из этих транзакций взять дату получения сообщения или дату совершения транзакции
- Оставить только уникальные даты относительно дня (уникальные d.m.Y)
- Проверить если курсы нужных валют за нужные даты есть в базе sqlite
- Если есть даты которых в локальной базе нет, сходить в API который указан выше столько раз сколко уникальных дат и взять курсы нужных валют, положить их в базу
- Когда на руках есть все нужные курсы, перевести все значения в MDL. Обновить все шаблоны таким образом чтобы в них был оригинальные amount + currency и переведенные в mdl. В случае когда сама транзакция в mdl тогда эти две пары полей будут одинаковыми
- Команда по-умолчанию которая выводит последние транзакции дополнительно еще выводит по 2 транзакции от каждого отправителя с валютой не по-умолчанию.

## Acceptance Criteria

- [ ] В конфиге сохраняются новые значения
- [ ] Проверка зависимостей проверяет возможность подключиться к sqlite
- [ ] Программа ходит в АПИ когда данных в локальной базе нет
- [ ] Программа НЕ ходит в АПИ когда данные в локальной базе есть

## Definition of Done

- [ ] All tests pass
- [ ] Test coverage > 90%
- [ ] Code compiles without errors
- [ ] Code is formatted with gofmt
- [ ] Following go best practices 
- [ ] Following sqlite best practices
