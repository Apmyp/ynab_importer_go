---
id: "007"
title: "Support YNAB"
branch: "feature/007-ynab"
---

# YNAB

## Description

Нужно взять все транзакции начиная с какой-то даты и загрузить из в YNAB. АПИ ключ будет присутствовать в среде где будет исполняться уже файл. АПИ ключ = ***REMOVED*** . Я его отзову как стори будет закончено

Не трогай, добавлять, редактируй существующие планы, транзакции, аккаунты.

Прочитай всю документацию и учти все best practices: https://api.ynab.com/ и https://api.ynab.com/v1
Особенно:
- Caching
- Fault Tolerance

Учти так же Rate Limiting

Изучи алгоритм до конца и задай свои вопросы.

Алгоритм такой:
- Взять из конфига plan id. Формат uuidv4. Для тестов сгенерируй любой. Для тестов во время разработки - создай новый план. Существующий план не трогай
- Возьми из конфига список аккаунтов (счетов). У каждого аккаунта есть два поля ynab_account_id и last4 (последние 4 цифры карты)
- Возьми дату отсечки - startAt - 2026-01-01
- Возьми все транзакции включительно и после указанной даты в startAt
- Из data json файла возьми все транзакции которые уже были отправлены и созданы в YNAB
- Отфильтруй транзакции которые еще не были отправлены в YNAB
- Соотнеси каждую транзакцию с одним из аккаунтов из конфига
- Сделай функцию которая принимает транзакцию и возвращает уникальный import_id. Так YNAB сможет не создавать у себя дубликаты в случае повторной отправки.
- Используй этот ендпоинт (POST /budgets/{budget_id}/transactions Create a single transaction or multiple transactions) чтобы отправить в YNAB транзакции которых там нет. Учитывай Rate Limit. Можешь использовать другой эндпоинт если этот не работает. Создавать транзакции исключительно в тестовом плане, а не в существующем.
  - В YNAB отправляем только MDL
- Пометь в локальном data json транзацкии которые успешно отправились


## Acceptance Criteria

- [ ] В конфиге сохраняются новые значения
- [ ] Проверка зависимостей проверяет возможность подключиться к sqlite
- [ ] Программа ходит в АПИ когда данных в локальной базе нет
- [ ] Программа НЕ ходит в АПИ когда данные в локальной базе есть
- [ ] Программа не портит данные в АПИ YNAB которые там уже есть. Тестовый план можно создать и в нем работать.

## Definition of Done

- [ ] All tests pass
- [ ] Test coverage > 90%
- [ ] Code compiles without errors
- [ ] Code is formatted with gofmt
- [ ] Following go best practices 
